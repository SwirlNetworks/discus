!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Discus=e()}}(function(){return function e(t,i,r){function n(s,u){if(!i[s]){if(!t[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=i[s]={exports:{}};t[s][0].call(l.exports,function(e){var i=t[s][1][e];return n(i?i:e)},l,l.exports,e,t,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(){},{}],2:[function(e,t){function i(){function e(){}var t=this,r=t.sync;Module,e.prototype=t,e.prototype.createClone=i,Module=new e,t.sync=function(){return Module.hasOwnProperty("sync")?Module.sync.apply(Module,arguments):r.apply(t,arguments)}}var r=e("backbone");t.exports=i.apply(r)},{}],3:[function(e,t){e("./discus"),e("./object"),e("./view"),e("./model"),e("./screen"),e("./super"),t.exports=e("./discus")},{"./discus":2,"./model":4,"./object":5,"./screen":6,"./super":7,"./view":8}],4:[function(e,t){var i=e("./discus"),r=e("./super");i.Model=function(){Backbone.Model.apply(this,arguments),this.discusInitialize.apply(this,arguments)},i.Model.prototype=Backbone.Model.prototype,i.Model.extend=Backbone.Model.extend,i.Model=i.Model.extend({_super:r,discusInitialize:function(e){this.___list_view_shared_views={},e&&e.parent&&console.error("Do not give models parents!!")},set:function(e){return e.toJSON||e.toArray,Backbone.Model.prototype.set.apply(this,arguments)},fetch:function(){var e=Backbone.Model.prototype.fetch.apply(this,arguments);return this.promise=e.promise,this.trigger("fetch",e.promise()),e}}),t.exports=i.Model},{"./discus":2,"./super":7}],5:[function(e,t){var i=e("underscore"),r=e("./discus"),n=e("./super");r.Object=function(){var e,t=this;this.cid=i.uniqueId("class"),e=arguments,t.init=function(){var i=t.initialize.apply(t,e);return function(){return i}}()},i.extend(r.Object.prototype,r.Events,{initialize:function(){return this},_super:n}),r.Object.extend=r.Model.extend,t.exports=r.Object},{"./discus":2,"./super":7}],6:[function(e){var t=e("./discus");e("./view"),t.Screen=t.View.extend({discusInitialize:function(){this._super("discusInitialize")}})},{"./discus":2,"./view":8}],7:[function(e,t){function i(e,t){for(var i=t;i[e]===t[e];)if(i=i.constructor.__super__,!i)throw new Error("Class has no super method for",e,". Remove the _super call to the non-existent method");return i}function r(e,t){void 0===this._superCallObjects&&(this._superCallObjects={});var r,n=this._superCallObjects[e],o=n||this,s=i(e,o);this._superCallObjects[e]=s;try{r=s[e].apply(this,t||[])}finally{n?this._superCallObjects[e]=n:delete this._superCallObjects[e]}return r}var n=e("./discus");_.each(["Collection","Router"],function(e){n[e].prototype._super=discusSuper}),t.exports=r},{"./discus":2}],8:[function(e,t){var i=e("./discus"),r=e("./super");i.View=function(){Backbone.View.apply(this,arguments),this.discusInitialize()},i.View.prototype=Backbone.View.prototype,i.View.extend=Backbone.View.extend,i.View=i.View.extend({_super:r,__lsModelCache:{},clearTimeout:function(e){return this.__timerIDS&&(this.__timerIDS=_(this.__timerIDS).without(e)),clearTimeout(e)},setTimeout:function(e,t,i){var r,n=this;return r=setTimeout(function(){this.__timerIDS=_(this.__timerIDS).without(r),e.apply(n,i)}),this.__timerIDS?this.__timerIDS.push(r):this.__timerIDS=[r],r},hasParent:function(){return!!this.__current_parent},setParent:function(e){if(this.__current_parent){if(this.__current_parent.cid===e.cid)return;this.stopListening(this.__current_parent,"destroyed",this.remove)}this.__current_parent=e,this.listenTo(this.__current_parent,"destroyed",this.remove),this.options.renderTo&&(this.__current_parent&&this.stopListening(this.__current_parent,"rendered"),this.listenTo(this.__current_parent,"rendered",function(){this.renderTo(this.__current_parent.$(this.options.renderTo))}))},discusInitialize:function(){if(this.options.parent){if(this.options.parent===window)return void console.error("Passed in parent: this when you meant to do parent: self");this.setParent(this.options.parent)}else this.options.renderTo&&console.error("renderTo does nothing without a parent!")},localStorage:function(e,t,i){function r(e,t){return App.user?App.user.storage.getItem(e,t):null}var n,o,s;return Modernizr.localstorage?this.__lsModelCache[e]?(n=this.__lsModelCache[e],o=n.toJSON(),o=_.defaults(o,t),n.set(o),this.__lsModelCache[e]):(n=new LocalStorage({},{lsKey:e,usePersistent:i}),s=r(e,i),s=_.defaults(s||{},t),s&&n.set(s),this.__lsModelCache[e]=n,n):void console.warn("LocalStorage is missing, expect odd behavior.")},getTemplateData:function(){var e,t={};return this.model&&$.extend(t,this.model.toJSON()),this.stateModel&&(e=this.stateModel.toJSON(),$.extend(t,{stateModel:e})),t},render:function(){var e,t;return e=this.getTemplateData(),this.stateModel&&(t=this.stateModel.toJSON()),t&&t.state&&this[t.state+"_template"]?this.$el.html(this[t.state+"_template"](e)):this.template&&this.$el.html(this.template(e)),this.redelegateEvents(),this.trigger("rendered"),this},renderTo:function(e){return this.$el.appendTo(e),this.render(),this},redelegateEvents:function(){return this.undelegateEvents(),this.delegateEvents(),this},detach:function(){this.isRemoved||this.$el.detach()},remove:function(){var e=this,t=(new Error).stack,r=e.cid;return this.isRemoved?void console.warn("This view was removed twice!",this.render.stack):(this._super("remove",arguments),this.$el.remove(),$(document).off("."+r),$(window).off("."+r),_(this.__timerIDS).each(clearTimeout),this.undelegateEvents(),this.stopListening(),this.isRemoved=!0,this.trigger("destroyed"),delete this.__current_parent,$.each(this,function(t){e.hasOwnProperty(t)&&"_superCallObjects"!==t&&"cid"!==t&&(App.isDev&&e[t]&&e[t]instanceof i.View&&!e[t].isRemoved&&"function"==typeof e[t].remove&&console.warn("[GC] Should this view",r,"have removed its sub-view",t,"?"),e[t]=null,delete e[t])}),this.model&&(this.model=null),this.collection&&(this.collection=null),this.isRemoved=!0,this.render=function(){console.log(t)},void(this.render.stack=t))},modalForm:function(e){return App.UI.modalForm(this.model),this.preventDefault(e)},preventDefault:function(e){return e?("function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation(),!1):!1},reloadable:function(e){App.router.isReloaded()?(App.router._reloadData.model&&(this.model=App.router._reloadData.model),App.router._reloadData.collection&&(this.collection=App.router._reloadData.collection),App.router._reloadData.stateModel&&(this.stateModel=App.router._reloadData.stateModel),delete App.router._reloadData):this.stateModel=new i.Model(e)}}),t.exports=i.View},{"./discus":2,"./super":7}]},{},[3])(3)});