!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Discus=e()}}(function(){var e;return function t(e,n,i){function r(o,a){if(!n[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var c=n[o]={exports:{}};e[o][0].call(c.exports,function(t){var n=e[o][1][t];return r(n?n:t)},c,c.exports,t,e,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,n){(function(t){!function(){function i(e){var t=!1;return function(){if(t)throw new Error("Callback was already called.");t=!0,e.apply(r,arguments)}}var r,s,o={};r=this,null!=r&&(s=r.async),o.noConflict=function(){return r.async=s,o};var a=Object.prototype.toString,l=Array.isArray||function(e){return"[object Array]"===a.call(e)},c=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)},d=function(e,t){if(e.map)return e.map(t);var n=[];return c(e,function(e,i,r){n.push(t(e,i,r))}),n},h=function(e,t,n){return e.reduce?e.reduce(t,n):(c(e,function(e,i,r){n=t(n,e,i,r)}),n)},u=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};"undefined"!=typeof t&&t.nextTick?(o.nextTick=t.nextTick,o.setImmediate="undefined"!=typeof setImmediate?function(e){setImmediate(e)}:o.nextTick):"function"==typeof setImmediate?(o.nextTick=function(e){setImmediate(e)},o.setImmediate=o.nextTick):(o.nextTick=function(e){setTimeout(e,0)},o.setImmediate=o.nextTick),o.each=function(e,t,n){function r(t){t?(n(t),n=function(){}):(s+=1,s>=e.length&&n())}if(n=n||function(){},!e.length)return n();var s=0;c(e,function(e){t(e,i(r))})},o.forEach=o.each,o.eachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var i=0,r=function(){t(e[i],function(t){t?(n(t),n=function(){}):(i+=1,i>=e.length?n():r())})};r()},o.forEachSeries=o.eachSeries,o.eachLimit=function(e,t,n,i){var r=f(t);r.apply(null,[e,n,i])},o.forEachLimit=o.eachLimit;var f=function(e){return function(t,n,i){if(i=i||function(){},!t.length||0>=e)return i();var r=0,s=0,o=0;!function a(){if(r>=t.length)return i();for(;e>o&&s<t.length;)s+=1,o+=1,n(t[s-1],function(e){e?(i(e),i=function(){}):(r+=1,o-=1,r>=t.length?i():a())})}()}},p=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[o.each].concat(t))}},g=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[f(e)].concat(n))}},m=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[o.eachSeries].concat(t))}},v=function(e,t,n,i){if(t=d(t,function(e,t){return{index:t,value:e}}),i){var r=[];e(t,function(e,t){n(e.value,function(n,i){r[e.index]=i,t(n)})},function(e){i(e,r)})}else e(t,function(e,t){n(e.value,function(e){t(e)})})};o.map=p(v),o.mapSeries=m(v),o.mapLimit=function(e,t,n,i){return _(t)(e,n,i)};var _=function(e){return g(e,v)};o.reduce=function(e,t,n,i){o.eachSeries(e,function(e,i){n(t,e,function(e,n){t=n,i(e)})},function(e){i(e,t)})},o.inject=o.reduce,o.foldl=o.reduce,o.reduceRight=function(e,t,n,i){var r=d(e,function(e){return e}).reverse();o.reduce(r,t,n,i)},o.foldr=o.reduceRight;var y=function(e,t,n,i){var r=[];t=d(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&r.push(e),t()})},function(){i(d(r.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};o.filter=p(y),o.filterSeries=m(y),o.select=o.filter,o.selectSeries=o.filterSeries;var w=function(e,t,n,i){var r=[];t=d(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||r.push(e),t()})},function(){i(d(r.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};o.reject=p(w),o.rejectSeries=m(w);var C=function(e,t,n,i){e(t,function(e,t){n(e,function(n){n?(i(e),i=function(){}):t()})},function(){i()})};o.detect=p(C),o.detectSeries=m(C),o.some=function(e,t,n){o.each(e,function(e,i){t(e,function(e){e&&(n(!0),n=function(){}),i()})},function(){n(!1)})},o.any=o.some,o.every=function(e,t,n){o.each(e,function(e,i){t(e,function(e){e||(n(!1),n=function(){}),i()})},function(){n(!0)})},o.all=o.every,o.sortBy=function(e,t,n){o.map(e,function(e,n){t(e,function(t,i){t?n(t):n(null,{value:e,criteria:i})})},function(e,t){if(e)return n(e);var i=function(e,t){var n=e.criteria,i=t.criteria;return i>n?-1:n>i?1:0};n(null,d(t.sort(i),function(e){return e.value}))})},o.auto=function(e,t){t=t||function(){};var n=u(e),i=n.length;if(!i)return t();var r={},s=[],a=function(e){s.unshift(e)},d=function(e){for(var t=0;t<s.length;t+=1)if(s[t]===e)return void s.splice(t,1)},f=function(){i--,c(s.slice(0),function(e){e()})};a(function(){if(!i){var e=t;t=function(){},e(null,r)}}),c(n,function(n){var i=l(e[n])?e[n]:[e[n]],s=function(e){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),e){var s={};c(u(r),function(e){s[e]=r[e]}),s[n]=i,t(e,s),t=function(){}}else r[n]=i,o.setImmediate(f)},p=i.slice(0,Math.abs(i.length-1))||[],g=function(){return h(p,function(e,t){return e&&r.hasOwnProperty(t)},!0)&&!r.hasOwnProperty(n)};if(g())i[i.length-1](s,r);else{var m=function(){g()&&(d(m),i[i.length-1](s,r))};a(m)}})},o.retry=function(e,t,n){var i=5,r=[];"function"==typeof e&&(n=t,t=e,e=i),e=parseInt(e,10)||i;var s=function(i,s){for(var a=function(e,t){return function(n){e(function(e,i){n(!e||t,{err:e,result:i})},s)}};e;)r.push(a(t,!(e-=1)));o.series(r,function(e,t){t=t[t.length-1],(i||n)(t.err,t.result)})};return n?s():s},o.waterfall=function(e,t){if(t=t||function(){},!l(e)){var n=new Error("First argument to waterfall must be an array of functions");return t(n)}if(!e.length)return t();var i=function(e){return function(n){if(n)t.apply(null,arguments),t=function(){};else{var r=Array.prototype.slice.call(arguments,1),s=e.next();r.push(s?i(s):t),o.setImmediate(function(){e.apply(null,r)})}}};i(o.iterator(e))()};var S=function(e,t,n){if(n=n||function(){},l(t))e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var i={};e.each(u(t),function(e,n){t[e](function(t){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),i[e]=r,n(t)})},function(e){n(e,i)})}};o.parallel=function(e,t){S({map:o.map,each:o.each},e,t)},o.parallelLimit=function(e,t,n){S({map:_(t),each:f(t)},e,n)},o.series=function(e,t){if(t=t||function(){},l(e))o.mapSeries(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};o.eachSeries(u(e),function(t,i){e[t](function(e){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),n[t]=r,i(e)})},function(e){t(e,n)})}},o.iterator=function(e){var t=function(n){var i=function(){return e.length&&e[n].apply(null,arguments),i.next()};return i.next=function(){return n<e.length-1?t(n+1):null},i};return t(0)},o.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var T=function(e,t,n,i){var r=[];e(t,function(e,t){n(e,function(e,n){r=r.concat(n||[]),t(e)})},function(e){i(e,r)})};o.concat=p(T),o.concatSeries=m(T),o.whilst=function(e,t,n){e()?t(function(i){return i?n(i):void o.whilst(e,t,n)}):n()},o.doWhilst=function(e,t,n){e(function(i){if(i)return n(i);var r=Array.prototype.slice.call(arguments,1);t.apply(null,r)?o.doWhilst(e,t,n):n()})},o.until=function(e,t,n){e()?n():t(function(i){return i?n(i):void o.until(e,t,n)})},o.doUntil=function(e,t,n){e(function(i){if(i)return n(i);var r=Array.prototype.slice.call(arguments,1);t.apply(null,r)?n():o.doUntil(e,t,n)})},o.queue=function(e,t){function n(e,t,n,i){return e.started||(e.started=!0),l(t)||(t=[t]),0==t.length?o.setImmediate(function(){e.drain&&e.drain()}):void c(t,function(t){var r={data:t,callback:"function"==typeof i?i:null};n?e.tasks.unshift(r):e.tasks.push(r),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),o.setImmediate(e.process)})}void 0===t&&(t=1);var r=0,s={tasks:[],concurrency:t,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,t){n(s,e,!1,t)},kill:function(){s.drain=null,s.tasks=[]},unshift:function(e,t){n(s,e,!0,t)},process:function(){if(!s.paused&&r<s.concurrency&&s.tasks.length){var t=s.tasks.shift();s.empty&&0===s.tasks.length&&s.empty(),r+=1;var n=function(){r-=1,t.callback&&t.callback.apply(t,arguments),s.drain&&s.tasks.length+r===0&&s.drain(),s.process()},o=i(n);e(t.data,o)}},length:function(){return s.tasks.length},running:function(){return r},idle:function(){return s.tasks.length+r===0},pause:function(){s.paused!==!0&&(s.paused=!0,s.process())},resume:function(){s.paused!==!1&&(s.paused=!1,s.process())}};return s},o.priorityQueue=function(e,t){function n(e,t){return e.priority-t.priority}function i(e,t,n){for(var i=-1,r=e.length-1;r>i;){var s=i+(r-i+1>>>1);n(t,e[s])>=0?i=s:r=s-1}return i}function r(e,t,r,s){return e.started||(e.started=!0),l(t)||(t=[t]),0==t.length?o.setImmediate(function(){e.drain&&e.drain()}):void c(t,function(t){var a={data:t,priority:r,callback:"function"==typeof s?s:null};e.tasks.splice(i(e.tasks,a,n)+1,0,a),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),o.setImmediate(e.process)})}var s=o.queue(e,t);return s.push=function(e,t,n){r(s,e,t,n)},delete s.unshift,s},o.cargo=function(e,t){var n=!1,i=[],r={tasks:i,payload:t,saturated:null,empty:null,drain:null,drained:!0,push:function(e,n){l(e)||(e=[e]),c(e,function(e){i.push({data:e,callback:"function"==typeof n?n:null}),r.drained=!1,r.saturated&&i.length===t&&r.saturated()}),o.setImmediate(r.process)},process:function s(){if(!n){if(0===i.length)return r.drain&&!r.drained&&r.drain(),void(r.drained=!0);var o="number"==typeof t?i.splice(0,t):i.splice(0,i.length),a=d(o,function(e){return e.data});r.empty&&r.empty(),n=!0,e(a,function(){n=!1;var e=arguments;c(o,function(t){t.callback&&t.callback.apply(null,e)}),s()})}},length:function(){return i.length},running:function(){return n}};return r};var b=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&c(n,function(t){console[e](t)}))}]))}};o.log=b("log"),o.dir=b("dir"),o.memoize=function(e,t){var n={},i={};t=t||function(e){return e};var r=function(){var r=Array.prototype.slice.call(arguments),s=r.pop(),a=t.apply(null,r);a in n?o.nextTick(function(){s.apply(null,n[a])}):a in i?i[a].push(s):(i[a]=[s],e.apply(null,r.concat([function(){n[a]=arguments;var e=i[a];delete i[a];for(var t=0,r=e.length;r>t;t++)e[t].apply(null,arguments)}])))};return r.memo=n,r.unmemoized=e,r},o.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},o.times=function(e,t,n){for(var i=[],r=0;e>r;r++)i.push(r);return o.map(i,t,n)},o.timesSeries=function(e,t,n){for(var i=[],r=0;e>r;r++)i.push(r);return o.mapSeries(i,t,n)},o.seq=function(){var e=arguments;return function(){var t=this,n=Array.prototype.slice.call(arguments),i=n.pop();o.reduce(e,n,function(e,n,i){n.apply(t,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);i(e,t)}]))},function(e,n){i.apply(t,[e].concat(n))})}},o.compose=function(){return o.seq.apply(null,Array.prototype.reverse.call(arguments))};var V=function(e,t){var n=function(){var n=this,i=Array.prototype.slice.call(arguments),r=i.pop();return e(t,function(e,t){e.apply(n,i.concat([t]))},r)};if(arguments.length>2){var i=Array.prototype.slice.call(arguments,2);return n.apply(this,i)}return n};o.applyEach=p(V),o.applyEachSeries=m(V),o.forever=function(e,t){function n(i){if(i){if(t)return t(i);throw i}e(n)}n()},"undefined"!=typeof n&&n.exports?n.exports=o:"undefined"!=typeof e&&e.amd?e([],function(){return o}):r.async=o}()}).call(this,t("1YiZ5S"))},{"1YiZ5S":3}],2:[function(){},{}],3:[function(e,t){function n(){}var i=t.exports={};i.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var i=n.shift();i()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=n,i.addListener=n,i.once=n,i.off=n,i.removeListener=n,i.removeAllListeners=n,i.emit=n,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")}},{}],4:[function(e,t){function n(){function e(){}var t,i=this,r=i.sync;return e.prototype=i,e.prototype.createClone=n,t=new e,i.sync=function(){return t.hasOwnProperty("sync")?t.sync.apply(t,arguments):r.apply(i,arguments)},t}var i=e("backbone.core");t.exports=n.apply(i)},{}],5:[function(e,t){function n(e){return e.scrollHeight>e.clientHeight}function i(e){for(;e&&!n(e);){if(e===e.parentNode)return null;e=e.parentNode}return e}function r(e){return function(){return this.isRemoved?void console.warn("ran on a removed list view"):e.apply(this,arguments)}}var s=e("./discus"),o=e("async");e("./view"),e("./model"),s.ListView=s.View.extend({className:"listView",tagName:"ul",events:{},defaults:function(){var e={viewClass:this.viewClass||null,viewClassOptions:{},showLoadingAnimation:!1,loadingPromise:(new $.Deferred).resolve(),multiSelect:!1,emptyImageType:"",renderOffscreen:3,scrollLoad:!0,searchEnabled:!1,searchInputSelector:"",contextMenu:null,showEmptyTableText:!1,emptyTableText:null,delayEmptyTableText:!0,hideIfEmpty:!1,initialSelection:null,dragOrderingEnabled:!1,readOnlyDrag:!1,dragOrderingSelector:"",renderLimit:8,renderThrottle:250,sparse:!1,sparseLimit:20,sparseTagName:"div",sharedView:this.options.shareView};return e},initialize:function(){console.log("Using listview 2!");var e=this;if(this.sparse={offset:0},_.defaults(this.options,this.defaults()),this._d={resetCollection:!1,modelChanges:{},viewCache:{},listCache:[],renderedViews:[]},this.options.sync||(this.updateViews=_.debounce(this.updateViews),this.renderModels=_.debounce(this.renderModels),this.selectedChanged=_.debounce(this.selectedChanged),this.handleScroll=_.debounce(this.handleScroll,10)),_.bindAll(this,"refilter","resort","resetCollection","renderModels"),this.stateModel=new s.Model({}),!this.options.viewClass)throw new Error("Must specify a viewClass name before initialization when using ListView "+this.options.viewClass);this.options.shareView&&console.error("please use sharedView, shareView was a dumb name."),this.options.childData&&(console.warn("Use viewClassOptions instead of childData"),this.options.viewClassOptions=$.extend({},this.options.childData,this.options.viewClassOptions)),this.loadingPromise=this.options.loadingPromise,this.collection.promise&&(this.loadingPromise=$.when(this.collection.promise(),this.loadingPromise)),this.loadingPromise.isResolved()||this.loadingPromise.done(function(){e._resetCollection()}),this.listenTo(this.collection,"fetch",function(e){var t=this;t.addLoadingPromise(e),0===this.collection.length&&this._resetCollection()}),this.listenTo(this.collection,"add",this._addModel),this.listenTo(this.collection,"remove",this._removeModel),this.listenTo(this.collection,"reset",this._resetCollection),this.listenTo(this.collection,"loading_promise",this.addLoadingPromise),this.options.onChange&&this.listenTo(this.collection,"change",this.modelChange),this.options.searchEnabled&&$(document).on("finishedtyping."+this.cid,this.options.searchInputSelector,this.refilter),void 0!==this.options.multiSelect&&this.options.initialSelection&&(this.initialSelection=this.options.initialSelection,_.isArray(this.initialSelection)||(this.initialSelection=[this.initialSelection]),this.initialSelection=_(this.initialSelection).map(function(e){return e.model?e.model.get("id"):e.id||e})),this.collection.length&&_.delay(this.resetCollection,this)},onViewsChanged:function(){},render:function(){this._super("render",arguments),this.$el.parent().length&&this.rebuildDOM()},rebuildDOM:function(){var e=this.getRenderTarget();return this.detachDOM(),e.empty(),this.$el.empty(),this.options.hideIfEmpty&&!this._d.renderedViews.length?void this.attachDOM():(this.renderHeader(),this.sparse.holder&&(this.sparse.holder.appendTo(this.$el),this.sparse.holder.attr("class","list_view_slider "+this.options.sparseClassName)),this.options.renderAttached&&this.attachDOM(),this.isLoading()?(this._d.loadingSpinnerShown=!0,this.renderLoading()):0===this._d.listCache.length?(this.showNoData(),this.renderFooter()):(_(this._d.renderedViews).each(function(t){t.renderTo(e)}),this.renderFooter()),void(this.options.renderAttached||this.attachDOM()))},resetCollection:r(function(){this._d.resetCollection=!0,this.updateViews()}),addModel:function(e){var t=this._d;return t.hasData?(t.modelChanges[e.cid]={t:"add",m:e},void this.updateViews()):this.resetCollection()},removeModel:function(e){this._d.modelChanges[e.cid]={t:"remove",m:e},this.updateViews()},modelChange:function(e){this.getView(e).render()},updateViews:r(function(){var e=this,t=this._d;return t.resetCollection?void this._resetCollection():(this.detachDOM(),$.each(t.modelChanges,function(n,i){delete t.modelChanges[n],e["_"+i.t+"Model"](i.m)}),this.renderModels(),void this.attachDOM())}),_detachCount:0,attachDOM:function(){this.options.renderAttached||(this._detachCount--,this._detachCount>0||(this.placeHolder.parent().length&&this.$el.insertAfter(this.placeHolder),this.placeHolder.remove(),this.placeHolder=null,this.redelegateEvents()))},detachDOM:function(){if(!this.options.renderAttached){if(this._detachCount>0)return void this._detachCount++;this.placeHolder=$("<div />",{css:{height:this.$el.height(),width:this.$el.width(),position:this.$el.css("position"),top:this.$el.css("top"),left:this.$el.css("left")}}).insertAfter(this.$el),this.$el.detach(),this._detachCount++}},_resetCollection:r(function(){var e,t=this,n=this._d;n.hasData=!1,n.modelChanges={},n.resetCollection=!1,console.log("Resetting the entire list view state!!!"),this.getRenderTarget().empty(),n.renderedViews=[],this.changed(),e=this.collection.models.concat(),e=_(e).filter(function(e){return t.filterModel(e)}),t.sortBy&&(e=_(e).sortBy(t.sortBy,t),t.sortBy.reverse&&e.reverse()),n.listCache=_(e).map(function(e){return{s:t.sortBy?t.sortBy(e):null,m:e}}),this.renderModels()}),_addModel:function(e){if(this.filterModel(e)){if(!this._d.listCache.length)return this.resetCollection();var t=this._d,n=this.sortBy(e),i={s:n,m:e},r=_.sortedIndex(t.listCache,i,"s");this.sortBy.reverse&&(r=t.listCache.length-r),t.listCache[r]&&t.listCache[r].m.cid===e.cid||(this.options.sparse&&r<this.getRenderOffset()&&(this.sparse.offset++,console.log("Adjusting offset to",this.sparse.offset)),t.listCache.splice(r,0,i),this.renderModels())}},_removeModel:function(e,t,n){var i=this.getView(e),r=this._d;this.options.sparse&&n.index<this.getRenderOffset()&&this.sparse.offset--,r.listCache=_(r.listCache).reject(function(t){return t.m.cid===e.cid}),i&&(i.detach(),r.renderedViews=_(r.renderedViews).without(i)),0===r.listCache.length&&this.resetCollection(),this.changed()},renderModels:r(function(){var e=this,t=this._d,n=this.getRenderOffset(),i=t.listCache;return this.renderTimerID&&(clearTimeout(this.renderTimerID),this.renderTimerID=null),this.isLoading()?(t.loadingSpinnerShown=!0,void this.renderLoading()):t.loadingSpinnerShown?(t.loadingSpinnerShown=!1,this.tableLoadingSpinner&&(this.tableLoadingSpinner.remove(),this.tableLoadingSpinner=null),void(this.renderTimerID=this.setTimeout(this.renderModels,this.options.renderThrottle))):0===t.listCache.length?void this.showNoData():(this.getRenderTarget().find(".empty_data_row").remove(),this.$el.removeClass("noData"),this.options.selectFirst&&this.selectFirst(),void 0!==this.options.multiSelect&&this.initialSelection&&this._d.listCache.length>0&&_(this._d.listCache).chain().filter(function(t){return e.initialSelection.indexOf(t.m.get("id")+"")>-1}).each(function(t){e.initialSelection=_.without(e.initialSelection,t.m.id),e.getStateModel(t.m).set("selected",!0)}),t.hasData=!0,this.options.sparse&&(console.log("Rendering views based on offset,",n),i=t.listCache.slice(n,n+this.options.sparseLimit),this.resetSparsePosition(),this.$el.css({height:this.sparse.rowHeight*this._d.listCache.length})),void(i.length===t.renderedViews.length&&_.isEqual(t.renderedViews,_(i).map(function(t){return e.getView(t.m)}))||(this.renderHeader(),0===t.renderedViews.length?this.chunkRender(i,!0):this.chunkRender(i,!1))))}),chunkRenderID:0,chunkRender:function(e,t){var n,i,r=this,s=this._d,a=this.chunkRenderID,l=[],c=this.getRenderTarget(),d=0,h=this.options.renderLimit;for(this.chunkRenderID=this.chunkRenderID+1,s.renderID=a,s.isRendering=!0,this.clearTimeout(s.chunkRenderTimerID),r.options.sparse&&console.log("Rendering",e.length),n=0,i=Math.ceil(e.length/h);i>n;++n)l.push(e.slice(n*h,(n+1)*h));r.options.sparse&&console.log("and doing it in",l.length,"chunks"),n=0,o.eachSeries(l,function(n,i){return r.isRemoved||s.renderID!==a?(console.log("Canceling stale render",a),r.clearTimeout(s.chunkRenderTimerID),i("Render canceled")):_(n).all(function(e){return r.collection.contains(e.m)})?(r.detachDOM(),r.removeFooter(),_(n).chain().filter(function(e){return e.v=r.getView(e.m),(!e.v||e.v.isRemoved)&&r.resetCollection(),e.v}).each(function(n){{var i=n.v,o=n.s;n.m}t?(s.renderedViews.push(i),i.detach(),i.$el.appendTo(c)):!function(){if(s.renderedViews.length<=d)return t=!0,i.$el.appendTo(c),void s.renderedViews.push(i);for(;s.renderedViews.length>d&&!_(e).any(function(e){return e.m.cid===s.renderedViews[d].model.cid});)r.options.sharedView?s.renderedViews.splice(d,1)[0].detach():s.renderedViews.splice(d,1)[0].remove();return s.renderedViews.length<=d?(t=!0,i.$el.appendTo(c),void s.renderedViews.push(i)):s.renderedViews[d].cid===i.cid?void(0===d?s.renderedViews[d].$el.prependTo(c):s.renderedViews[d].$el.insertAfter(s.renderedViews[d-1].$el)):(r.sortBy.reverse?r.sortBy(s.renderedViews[d].model)>o:r.sortBy(s.renderedViews[d].model)<o,!s.renderedViews[d].$el.closest(r.$el).length,i.detach(),i.$el.insertBefore(s.renderedViews[d].$el),void s.renderedViews.splice(d,0,i))}(),i.render(),d++}),r.onViewsChanged(),r.attachDOM(),r.renderFooter(),void(r.options.sync?i():s.chunkRenderTimerID=r.setTimeout(i,r.options.renderThrottle))):(console.log("Canceling bad render data",a),r.clearTimeout(s.chunkRenderTimerID),i("Render canceled"))},function(e){if(!r.isRemoved){if(s.renderID!==a)return void(r.options.sparse&&console.log("Completing canceled render...",d));s.isRendering=!1,r.removeFooter(),r.renderFooter(),console.log("Finished chunk rendering",d,n),r.changed()}})},removeFooter:function(){var e=this._d.renderedViews,t=e.length?e[e.length-1]:null;this.tableLoadingSpinner&&!this._d.loadingSpinnerShown&&(this.tableLoadingSpinner.remove(),this.tableLoadingSpinner=null),t&&(t.$el.next().remove(),t.render())},resetViews:function(){console.error("resetViews is depreciated, consider using a more intelligent method")},resort:function(){var e=this,t=this._d;t.listCache=_(t.listCache).sortBy(function(t){return t.s=e.sortBy(t.m),t.s}),e.sortBy.reverse&&t.listCache.reverse(),t.renderedViews=[],this.getRenderTarget().empty(),this.renderModels()},refilter:function(){this.resetCollection()},filterModel:function(e){return this.filterBy(e.toJSON(),e)},changed:function(){var e=this;this.changedQueued||(this.changedQueued=!0,_.delay(function(){e.isRemoved||(e.changedQueued=!1,e.onChange())}))},onChange:function(){this.trigger("changed")},sortBy:function(e){return this.collection.indexOf(e)},filterBy:function(e){var t=this,n=!0;if(this.options.searchEnabled){var i=$(this.options.searchInputSelector).val(),r=i?i.toLowerCase().split(" "):null,s=!1;s=null===r?!0:_.all(r,function(n){return _.any(_.filter(t.collection.fieldMetadata,function(e){return"function"==typeof e.getFilterData}),function(t,i){var r="function"==typeof t.getFilterData?t.getFilterData(e):e[i];r&&r.value&&(r=r.value);var s=r&&-1!==r.toString().toLowerCase().indexOf(n);return s})}),n=s}return"1"!==e.deleted&&n},renderHeader:function(){},renderFooter:function(){(this._d.isRendering||this.isLoading())&&this.renderLoading()},getOrder:function(){var e=[];return _.each(this.$(this.options.dragOrderingSelector),function(t){e.push($(t).data("modelId"))}),e.join(",")},orderChanged:function(){this.trigger("order_changed",this.getOrder())},generateSparseRenderTarget:function(){var e,t=this.sparse;return t.holder||(t.holder=$("<"+this.options.sparseTagName+" />",{"class":"list_view_slider "+this.options.sparseClassName,css:{width:"100%",height:"10000px",position:"relative"}}).appendTo(this.$el)),e=i(t.holder.get(0)),t.holder.css({height:"auto"}),e?(e=$(e),this.setupScrollParent(e),this.updateSparseSizing(),t.holder):t.holder},handleScroll:function(){if(this.sparse.rowHeight||this.updateSparseSizing(),this.sparse.rowHeight){var e,t,n=this._d,i=this.sparse,r=this.getRenderOffset(),s=i.scrollParent.get(0),o=s.scrollTop-i.scrollHeightOffset,a=i.rowHeight*r,l=this.options.sparseLimit-~~(s.offsetHeight/i.rowHeight);o-=a,o&&(r>0&&0>o?i.offset=r+o/i.rowHeight-l:o>i.rowHeight*l&&(i.offset=r+o/i.rowHeight),i.offset!==r&&(i.offset=~~Math.max(0,i.offset),i.offset=Math.min(parseInt(this.collection.metadata.total)-this.options.sparseLimit,i.offset)),i.offset!==r&&(e=i.offset-r,e>this.options.sparseLimit||0-e>this.options.sparseLimit?(n.renderedViews=[],this.getRenderTarget().empty()):(t=n.renderedViews.splice(e,this.options.sparseLimit-e),e>0&&!function(e){t=n.renderedViews,n.renderedViews=e}(t),this.resetSparsePosition(),_(t).each(function(e){e.detach()})),console.log("Changing the offset to",i.offset),console.log(o,i.rowHeight),this.renderModels()))}},resetSparsePosition:function(){this.getRenderTarget().css({top:this.sparse.offset*this.sparse.rowHeight})},setupScrollParent:function(e){var t=this,n=this.sparse;n.scrollParent&&n.scrollParent.off("scroll.sparse"+t.cid),n.scrollParent=e,n.scrollParentListener=n.scrollParent,e&&e.length&&("BODY"===n.scrollParent.get(0).tagName&&(n.scrollParentListener=$(window)),n.scrollParentListener.on("scroll.sparse"+this.cid,function(){return t.isRemoved?void n.scrollParentListener.off("scroll.sparse"+t.cid):void t.handleScroll()}))},updateSparseSizing:function(){if(this.options.sparse&&0!==this._d.renderedViews.length){if(!this.sparse.scrollParent)return this.generateSparseRenderTarget();this.sparse.rowHeight||(this.sparse.rowHeight=this._d.renderedViews[0].$el.height()),this.$el.css({height:this.sparse.rowHeight*this._d.listCache.length}),this.sparse.scrollParent&&!this.sparse.scrollHeightOffset&&(this.sparse.holder.css({top:"auto"}),this.sparse.scrollHeightOffset=this.sparse.holder.offset().top-(this.sparse.scrollParent.offset()?this.sparse.scrollParent.offset().top:0))}},addLoadingPromise:function(e){var t=this,n=!this.isLoading();return!e||!e.done,this.loadingPromise=$.when(e,this.loadingPromise),this.loadingPromise.done(function(){t._resetCollection()}),n&&this.renderModels(),this.loadingPromise},setLoadingPromise:function(){},isLoading:function(){return 0===this.collection.length&&!this.loadingPromise.isResolved()},renderLoading:function(){this.options.showLoadingAnimation&&this.tableLoadingSpinner&&this.tableLoadingSpinner.renderTo(this.$el)},showNoData:function(e){this.getRenderTarget().empty(),this.options.hideIfEmpty||(this.$el.addClass("noData"),this.renderHeader(),this.renderEmpty(e))},renderEmpty:function(e){if("tbody"===this.tagName||"table"===this.tagName){var t,n=this.collection.model;n.hasOwnProperty("noun")?t=n.noun:this.options.emptyImageType||(e="No Data"),this.options.emptyTableText&&(e=this.options.emptyTableText),this.getRenderTarget().append(['<tr class="no-click no-bg no-border empty_data_row">','<td class="empty_data_cell" colspan="99999">','<div class="empty_table_holder">','<div class="empty_table_image '+(this.options.emptyImageType||t)+'"></div>',"</div>","</td>","</tr>"].join(""))}else"div"===this.tagName?-1!==this.className.indexOf("isotope_list_view")&&(this.getRenderTarget().append(['<div class="empty_isotope_image '+(this.options.emptyImageType||t)+'"></div>'].join("")),this.getRenderTarget().height("340px")):"ul"===this.tagName&&this.getRenderTarget().append(this.options.emptyImageType?['<div class="empty_list_image '+(this.options.emptyImageType||t)+'"></div>'].join(""):[].join(""))},getRenderOffset:function(){return this.sparse.offset},getRenderTarget:function(){if(this.options.sparse){if(this.sparse.holder)return this.sparse.holder.parent().get(0)!==this.el&&this.sparse.holder.appendTo(this.$el),this.sparse.holder;if(this.$el.parent().length||this.placeHolder&&this.placeHolder.parent().length)return this.generateSparseRenderTarget()}return this.$el},getView:function(e){var t=this._d.viewCache[e.cid];return t&&!t.isRemoved?t:this.collection.contains(e)?this.options.sharedView&&e.___list_view_shared_views[this.options.sharedView]?e.___list_view_shared_views[this.options.sharedView]:(t=new this.options.viewClass($.extend(!0,{},this.options.viewClassOptions,{parent:this.options.sharedView?this.options.parent||this:this,model:e,collection:this.collection})),t.collection=this.collection,this._d.viewCache[e.cid]=t,this.options.sharedView&&(e.___list_view_shared_views[this.options.sharedView]=t,this.listenToOnce(t,"destroyed",function(){})),this.stopListening(this.getStateModel(e)),this.listenTo(this.getStateModel(e),"change:selected",this.selectedChanged),t):null},getStateModel:function(e){var t=this.options.sharedView?this.options.sharedView:this.cid;return"string"==typeof e||"number"==typeof e?e=this.collection.get(e):!e.toJSON&&e.id&&(e=this.collection.get(e.id)),e?(e.__list_view_state_models||(e.__list_view_state_models={}),e.__list_view_state_models[t]||(e.__list_view_state_models[t]=new s.Model({selected:!1})),e.__list_view_state_models[t]):null},selectedChanged:r(function(e){e instanceof s.Model&&this.options.multiSelect===!1&&this.getStateModel(e).get("selected")&&this.unselectAll(e.id),this.trigger("selected_changed",e),this.$el.trigger("selected_changed",e)}),selectFirst:function(){var e=this.getSelected(),t=this._d.listCache;t.length&&(0===e.length?e=null:e.length&&(e=e[0]),e&&!_.any(t,function(t){return t.m.cid===e.cid})&&(e=null),e||this.selectByID(t[0].m.id))},selectAll:function(e){var t=this,n=!1;return n=e.target?$(e.target).is(":checked"):!!e,_(this._d.listCache).each(function(e){t.getStateModel(e.m).set({selected:n})}),!0},getSelected:function(){var e=this;return this.collection.chain().filter(function(t){return e.getStateModel(t).attributes.selected}).value()},isSelected:function(e){return this.getStateModel(e).get("selected")},getSelectedModels:function(){return this.collection.filter(this.isSelected,this)},selectByID:function(e){var t=this.collection.get(e);if(t)return this.options.multiSelect||this.unselectAll(e),this.getStateModel(t).set({selected:!0}),this.stateModel&&this.stateModel.set({selectedRow:t}),!0},unselectAll:function(e){var t=this;this.collection.each(function(n){n.id==e||_(e).contains(n.id)||t.getStateModel(n).set({selected:!1})})},redelegateEvents:function(){this._super("redelegateEvents",arguments),_(this._d.renderedViews).each(function(e){e.redelegateEvents()})},remove:function(){this.sparse.scrollParent&&this.sparse.scrollParent.off("scroll.sparse"+this.cid),this._super("remove",arguments)}}),t.exports=s.ListView},{"./discus":4,"./model":7,"./view":11,async:1}],6:[function(e,t){e("./discus"),e("./object"),e("./view"),e("./model"),e("./screen"),e("./super"),e("./listview"),t.exports=e("./discus")
},{"./discus":4,"./listview":5,"./model":7,"./object":8,"./screen":9,"./super":10,"./view":11}],7:[function(e,t){var n=e("./discus"),i=e("./super");n.Model=function(){Backbone.Model.apply(this,arguments),this.discusInitialize.apply(this,arguments)},n.Model.prototype=Backbone.Model.prototype,n.Model.extend=Backbone.Model.extend,n.Model=n.Model.extend({_super:i,discusInitialize:function(e){this.___list_view_shared_views={},e&&e.parent&&console.error("Do not give models parents!!")},set:function(e){return e.toJSON||e.toArray,Backbone.Model.prototype.set.apply(this,arguments)},fetch:function(){var e=Backbone.Model.prototype.fetch.apply(this,arguments);return this.promise=e.promise,this.trigger("fetch",e.promise()),e}}),t.exports=n.Model},{"./discus":4,"./super":10}],8:[function(e,t){var n=e("underscore"),i=e("./discus"),r=e("./super");i.Object=function(){var e,t=this;this.cid=n.uniqueId("class"),e=arguments,t.init=function(){var n=t.initialize.apply(t,e);return function(){return n}}()},n.extend(i.Object.prototype,i.Events,{initialize:function(){return this},_super:r}),i.Object.extend=i.Model.extend,t.exports=i.Object},{"./discus":4,"./super":10}],9:[function(e){var t=e("./discus");e("./view"),t.Screen=t.View.extend({discusInitialize:function(){this._super("discusInitialize")}})},{"./discus":4,"./view":11}],10:[function(e,t){function n(e,t){for(var n=t;n[e]===t[e];)if(n=n.constructor.__super__,!n)throw new Error("Class has no super method for",e,". Remove the _super call to the non-existent method");return n}function i(e,t){void 0===this._superCallObjects&&(this._superCallObjects={});var i,r=this._superCallObjects[e],s=r||this,o=n(e,s);this._superCallObjects[e]=o;try{i=o[e].apply(this,t||[])}finally{r?this._superCallObjects[e]=r:delete this._superCallObjects[e]}return i}var r=e("./discus");_.each(["Collection","Router"],function(e){r[e].prototype._super=i}),t.exports=i},{"./discus":4}],11:[function(e,t){var n=e("./discus"),i=e("./super");n.View=function(){Backbone.View.apply(this,arguments),this.discusInitialize()},n.View.prototype=Backbone.View.prototype,n.View.extend=Backbone.View.extend,n.View=n.View.extend({_super:i,__lsModelCache:{},clearTimeout:function(e){return this.__timerIDS&&(this.__timerIDS=_(this.__timerIDS).without(e)),clearTimeout(e)},setTimeout:function(e,t,n){var i,r=this;return i=setTimeout(function(){this.__timerIDS=_(this.__timerIDS).without(i),e.apply(r,n)}),this.__timerIDS?this.__timerIDS.push(i):this.__timerIDS=[i],i},addChild:function(e){this.__children||(this.__children={}),this.__children[e.cid]=e,this.listenTo(e,"destroyed",function(){this.removeChild(e)})},removeChild:function(e){delete this.__children[e.cid],this.stopListening(e,"destroyed"),e.parent().cid===this.cid&&e.setParent()},hasParent:function(){return!!this.__current_parent},parent:function(){return this.__current_parent},setParent:function(e){if(this.__current_parent){if(e&&this.__current_parent.cid===e.cid)return;this.stopListening(this.__current_parent,"destroyed",this.remove),this.stopListening(this.__current_parent,"rendered")}this.__current_parent=e,e&&(this.listenTo(this.__current_parent,"destroyed",this.remove),"function"==e.addChild&&e.addChild(this),this.options.renderTo&&this.listenTo(this.__current_parent,"rendered",function(){this.renderTo(this.__current_parent.$(this.options.renderTo))}))},checkRenderComplete:function(){_.all(this.__readyPromises,function(e){return e.isResolved()})&&_.all(this.__children,function(e){return e.isRenderComplete})&&(this.trigger("renderComplete"),console.log("--- renderComplete: ",this))},readyAfter:function(e){var t=this;this.__readyPromises||(this.__readyPromises=[]),this.__readyPromises.push(e),e.done(function(){t.checkRenderComplete()})},discusInitialize:function(){if(this.__children={},this.options.parent){if(this.options.parent===window)return void console.error("Passed in parent: this when you meant to do parent: self");this.setParent(this.options.parent)}else this.options.renderTo&&console.error("renderTo does nothing without a parent!");if(!this.options.readyAfterModel&&this.model&&this.model.promise)try{this.readyAfter(this.model.promise())}catch(e){}!this.options.readyAfterCollection&&this.collection&&(this.collection.promise&&this.readyAfter(this.collection.promise()),this.listenTo(this.collection,"fetch fetchAll",this.readyAfter))},getTemplateData:function(){var e,t={};return this.model&&$.extend(t,this.model.toJSON()),this.stateModel&&(e=this.stateModel.toJSON(),$.extend(t,{stateModel:e})),t},render:function(){var e,t;return e=this.getTemplateData(),this.stateModel&&(t=this.stateModel.toJSON()),t&&t.state&&this[t.state+"_template"]?this.$el.html(this[t.state+"_template"](e)):this.template&&this.$el.html(this.template(e)),this.redelegateEvents(),this.trigger("rendered"),this},renderTo:function(e){return this.$el.appendTo(e),this.render(),this},redelegateEvents:function(){return this.undelegateEvents(),this.delegateEvents(),this},detach:function(){this.isRemoved||this.$el.detach()},remove:function(){var e=this,t=(new Error).stack,i=e.cid;return this.isRemoved?void console.warn("This view was removed twice!",this.render.stack):(this._super("remove",arguments),this.$el.remove(),$(document).off("."+i),$(window).off("."+i),_(this.__timerIDS).each(clearTimeout),this.undelegateEvents(),this.stopListening(),this.isRemoved=!0,this.trigger("destroyed"),delete this.__current_parent,$.each(this,function(t){e.hasOwnProperty(t)&&"_superCallObjects"!==t&&"cid"!==t&&(App.isDev&&e[t]&&e[t]instanceof n.View&&!e[t].isRemoved&&"function"==typeof e[t].remove&&console.warn("[GC] Should this view",i,"have removed its sub-view",t,"?"),e[t]=null,delete e[t])}),this.model&&(this.model=null),this.collection&&(this.collection=null),this.isRemoved=!0,this.render=function(){console.log(t)},void(this.render.stack=t))},modalForm:function(e){return App.UI.modalForm(this.model),this.preventDefault(e)},preventDefault:function(e){return e?("function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation(),!1):!1}}),t.exports=n.View},{"./discus":4,"./super":10}]},{},[6])(6)});